-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Servidor: 127.0.0.1:3306
-- Tiempo de generación: 24-10-2024 a las 04:54:42
-- Versión del servidor: 8.3.0
-- Versión de PHP: 8.2.18

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Base de datos: `mensapp3`
--

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `amigos`
--

DROP TABLE IF EXISTS `amigos`;
CREATE TABLE IF NOT EXISTS `amigos` (
  `user_id` int NOT NULL,
  `friend_id` int NOT NULL,
  `status` enum('pending','accepted','rejected') NOT NULL DEFAULT 'pending',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`,`friend_id`),
  KEY `friend_id` (`friend_id`),
  KEY `status_idx` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Volcado de datos para la tabla `amigos`
--

INSERT INTO `amigos` (`user_id`, `friend_id`, `status`, `created_at`, `updated_at`) VALUES
(4, 6, 'accepted', '2024-10-24 02:37:33', '2024-10-24 02:49:58'),
(6, 4, 'accepted', '2024-10-24 02:43:07', '2024-10-24 02:49:58');

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `mensajes`
--

DROP TABLE IF EXISTS `mensajes`;
CREATE TABLE IF NOT EXISTS `mensajes` (
  `id` int NOT NULL AUTO_INCREMENT,
  `sender_id` int NOT NULL,
  `receiver_id` int NOT NULL,
  `content` blob NOT NULL,
  `nonce` binary(12) NOT NULL,
  `timestamp` datetime DEFAULT CURRENT_TIMESTAMP,
  `is_read` tinyint(1) DEFAULT '0',
  `key_version` int DEFAULT '1',
  `encryption_timestamp` datetime DEFAULT CURRENT_TIMESTAMP,
  `deleted_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `sender_id` (`sender_id`),
  KEY `receiver_id` (`receiver_id`),
  KEY `timestamp_idx` (`timestamp`)
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Volcado de datos para la tabla `mensajes`
--

INSERT INTO `mensajes` (`id`, `sender_id`, `receiver_id`, `content`, `nonce`, `timestamp`, `is_read`, `key_version`, `encryption_timestamp`, `deleted_at`) VALUES
(1, 4, 6, 0x3136373739373935393731643838306435633964376532323938326666313964616530643661626366636463, 0x393763343464363339393666, '2024-10-24 05:42:01', 0, 1, '2024-10-24 05:42:01', NULL),
(2, 4, 6, 0x32646365303936623437623635336165366462663137383665353861366163616438666136323731333034623661313062323864, 0x303838336537636130346134, '2024-10-24 05:42:07', 0, 1, '2024-10-24 05:42:07', NULL),
(3, 4, 6, 0x363038666433383265363930396663303736326266373466636438356561333761613065333563386361636433303335326466356236, 0x663435636432313033373730, '2024-10-24 05:42:07', 0, 1, '2024-10-24 05:42:07', NULL),
(4, 4, 6, 0x6130356234646161383434303135386566303734333162336532353664396631653838613437373438633230626536626531653631303135616530323362646334323832343938613166, 0x363432303638646635633232, '2024-10-24 05:42:09', 0, 1, '2024-10-24 05:42:09', NULL),
(5, 4, 6, 0x36653338303830326632663839383231353161386637373563313434383262326231386634653435396339663135, 0x346663363764333034633633, '2024-10-24 05:42:31', 0, 1, '2024-10-24 05:42:31', NULL),
(6, 4, 6, 0x34376435393333623831346532383063303365316339313835376565633465306537333833623166343637613136653964313839, 0x356331653438366335613662, '2024-10-24 05:42:31', 0, 1, '2024-10-24 05:42:31', NULL),
(7, 4, 6, 0x3133353666303733326231323534613734393636386330313765323830396336653661336531353366656432393463376138, 0x646337666464393938346632, '2024-10-24 05:42:51', 0, 1, '2024-10-24 05:42:51', NULL),
(8, 4, 6, 0x646332303839366330326432333662333233383830333036333533316439623731623232303933303036306337326661, 0x326230323131633833346234, '2024-10-24 05:44:06', 0, 1, '2024-10-24 05:44:06', NULL),
(9, 4, 6, 0x326531376530313635653666346666356565306265336131613731663038633531336235653833366634306165353866353037313639, 0x636666626237353663666364, '2024-10-24 05:44:09', 0, 1, '2024-10-24 05:44:09', NULL),
(10, 4, 6, 0x6536316465336466346530383662313830333636333038613933616437376566363232373731616537666435376663343735, 0x656564636136363639386461, '2024-10-24 05:44:13', 0, 1, '2024-10-24 05:44:13', NULL),
(11, 4, 6, 0x6137353133303336343839316132396165626564373931643530383932363536623739326233383532386663626431646538, 0x383737336636343837346436, '2024-10-24 05:47:49', 0, 1, '2024-10-24 05:47:49', NULL),
(12, 4, 6, 0x38353232373931336636393365336635623232643164343164316534383935396463393335636531366537646434, 0x306261306338386634323839, '2024-10-24 05:51:02', 0, 1, '2024-10-24 05:51:02', NULL),
(13, 4, 6, 0x30666134373363626130366431663061653537646338316362343863376639646232613835356630303932303839, 0x633839363033636239636139, '2024-10-24 05:51:04', 0, 1, '2024-10-24 05:51:04', NULL),
(14, 4, 6, 0x62643234653362356165633533633830663962363935313230653333393264656261346261666130643333663337, 0x326636353433383432363239, '2024-10-24 05:51:10', 0, 1, '2024-10-24 05:51:10', NULL),
(15, 4, 6, 0x63393030616331306231363865316237393366323731633233663837373930323366306262656332393263393833, 0x373465366530353664356234, '2024-10-24 05:51:13', 0, 1, '2024-10-24 05:51:13', NULL),
(16, 4, 6, 0x7fdbdfd9cca3794dc25bd20178c0c1a27bcc84349470, 0x6c5cfe3b26114b156cb96d39, '2024-10-24 06:52:49', 0, 1, '2024-10-24 06:52:49', NULL),
(17, 4, 6, 0x725f531e71bd0c834ca0929d64f2f0d72febe128667f1d, 0x6a7539e3c70ff30a8d876121, '2024-10-24 06:52:50', 0, 1, '2024-10-24 06:52:50', NULL),
(18, 4, 6, 0x7f1dbd1c5cdc663f7f60d88ae1139cb9062e799ef10289be, 0xef399a60d62f345c7cbfe1a5, '2024-10-24 06:52:52', 0, 1, '2024-10-24 06:52:52', NULL),
(19, 4, 6, 0x217dcbf2f4a23374167e328a0c02de726e94698b53ad4cc1, 0x6152bac7caddb7cb25cc94e9, '2024-10-24 06:52:54', 0, 1, '2024-10-24 06:52:54', NULL);

-- --------------------------------------------------------

--
-- Estructura de tabla para la tabla `usuarios`
--

DROP TABLE IF EXISTS `usuarios`;
CREATE TABLE IF NOT EXISTS `usuarios` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL,
  `email` varchar(100) NOT NULL,
  `password_hash` varchar(255) NOT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `last_login` datetime DEFAULT NULL,
  `login_attempts` int DEFAULT '0',
  `last_attempt` datetime DEFAULT NULL,
  `status` enum('active','inactive','blocked') DEFAULT 'active',
  `failed_attempts` int DEFAULT '0',
  `locked_until` datetime DEFAULT NULL,
  `last_password_change` datetime DEFAULT CURRENT_TIMESTAMP,
  `session_id` varchar(128) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`),
  KEY `status_idx` (`status`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- Volcado de datos para la tabla `usuarios`
--

INSERT INTO `usuarios` (`id`, `username`, `email`, `password_hash`, `created_at`, `updated_at`, `last_login`, `login_attempts`, `last_attempt`, `status`, `failed_attempts`, `locked_until`, `last_password_change`, `session_id`) VALUES
(4, 'osorio1', 'r.osorio17@yahoo.com', '$argon2id$v=19$m=65536,t=3,p=4$ZpTDE2oxZ/N2kF1eLdPUog$HJphJ9DomFgP2Mf0Ou9ZHRIq4fNmIU5QKL8xgu9D1Os', '2024-10-24 00:34:38', '2024-10-24 03:41:56', '2024-10-24 05:41:56', 0, NULL, 'active', 0, NULL, '2024-10-24 02:34:38', 'ZK5BQFa8PoYchZ59HZ__V0Sy_KO5SMc_jGZgKHzG-6M'),
(6, 'osorio2', 'r.osorioo17@yahoo.com', '$argon2id$v=19$m=65536,t=3,p=4$Z8z/AubCIpLFUntiKG3xTA$rUvIch4MO9HnMAcnpGMWDjb7gwM6POWaASoRuC8d1to', '2024-10-24 00:37:16', '2024-10-24 00:43:02', '2024-10-24 02:43:02', 0, NULL, 'active', 0, NULL, '2024-10-24 02:37:16', 'XRkUTZeqh0oAPeANv6DF9pbsqnu7beHeTKYbm5-BRcM');

--
-- Restricciones para tablas volcadas
--

--
-- Filtros para la tabla `amigos`
--
ALTER TABLE `amigos`
  ADD CONSTRAINT `fk_friend` FOREIGN KEY (`friend_id`) REFERENCES `usuarios` (`id`),
  ADD CONSTRAINT `fk_user` FOREIGN KEY (`user_id`) REFERENCES `usuarios` (`id`);

--
-- Filtros para la tabla `mensajes`
--
ALTER TABLE `mensajes`
  ADD CONSTRAINT `fk_receiver` FOREIGN KEY (`receiver_id`) REFERENCES `usuarios` (`id`),
  ADD CONSTRAINT `fk_sender` FOREIGN KEY (`sender_id`) REFERENCES `usuarios` (`id`);
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
